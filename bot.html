<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>AI Assistant - Dodie's</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: #000;
  color: #fff;
  height: 100vh;
  display: flex;
  flex-direction: column;
}

.header {
  padding: 20px;
  background: #1a1a1a;
  border-bottom: 2px solid #DC143C;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.header-left {
  display: flex;
  align-items: center;
  gap: 16px;
}

.logo {
  font-size: 40px;
}

h1 {
  font-size: 24px;
  color: #DC143C;
  font-weight: 800;
}

.back {
  padding: 8px 16px;
  background: #000;
  border: 2px solid #DC143C;
  border-radius: 8px;
  color: #fff;
  text-decoration: none;
  font-weight: 600;
}

.back:hover {
  background: #DC143C;
}

.messages {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.message {
  display: flex;
  gap: 12px;
  max-width: 80%;
  animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.message.user {
  margin-left: auto;
  flex-direction: row-reverse;
}

.avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  flex-shrink: 0;
}

.message.bot .avatar {
  background: #DC143C;
}

.message.user .avatar {
  background: #FFD700;
}

.bubble {
  padding: 14px 18px;
  border-radius: 16px;
  line-height: 1.5;
}

.message.bot .bubble {
  background: #1a1a1a;
  border: 1px solid #333;
}

.message.user .bubble {
  background: #DC143C;
  color: #fff;
}

.thinking {
  display: flex;
  gap: 12px;
  max-width: 80%;
}

.thinking .bubble {
  background: #1a1a1a;
  border: 1px solid #333;
  padding: 16px;
  display: flex;
  gap: 6px;
}

.dot {
  width: 8px;
  height: 8px;
  background: #DC143C;
  border-radius: 50%;
  animation: bounce 1.4s ease-in-out infinite;
}

.dot:nth-child(2) { animation-delay: 0.2s; }
.dot:nth-child(3) { animation-delay: 0.4s; }

@keyframes bounce {
  0%, 60%, 100% { transform: translateY(0); }
  30% { transform: translateY(-10px); }
}

.welcome {
  text-align: center;
  padding: 40px 20px;
  max-width: 500px;
  margin: auto;
}

.welcome-icon {
  font-size: 64px;
  margin-bottom: 20px;
}

.welcome h2 {
  font-size: 28px;
  color: #DC143C;
  margin-bottom: 12px;
}

.welcome p {
  color: #999;
  margin-bottom: 24px;
}

.suggestions {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.suggestion {
  padding: 12px 16px;
  background: #1a1a1a;
  border: 1px solid #333;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.2s;
  text-align: left;
}

.suggestion:hover {
  border-color: #DC143C;
  background: #2a2a2a;
}

.input-area {
  padding: 20px;
  background: #1a1a1a;
  border-top: 2px solid #DC143C;
}

.input-wrapper {
  display: flex;
  gap: 12px;
  max-width: 1000px;
  margin: 0 auto;
}

input {
  flex: 1;
  padding: 14px 18px;
  background: #000;
  border: 1px solid #333;
  border-radius: 10px;
  color: #fff;
  font-size: 15px;
}

input:focus {
  outline: none;
  border-color: #DC143C;
}

.send-btn {
  padding: 14px 24px;
  background: #DC143C;
  border: none;
  border-radius: 10px;
  color: #fff;
  font-weight: 700;
  cursor: pointer;
}

.send-btn:hover:not(:disabled) {
  background: #B01030;
}

.send-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

@media (max-width: 768px) {
  .message { max-width: 90%; }
}
</style>
</head>
<body>

<div class="header">
  <div class="header-left">
    <div class="logo">ü¶û</div>
    <h1>DODIE'S AI ASSISTANT</h1>
  </div>
  <a href="index.html" class="back">‚Üê Back</a>
</div>

<div class="messages" id="messages">
  <div class="welcome" id="welcome">
    <div class="welcome-icon">ü§ñ</div>
    <h2>How can I help you?</h2>
    <p>Ask me about the menu, waitlist, seafood availability, or anything else!</p>
    <div class="suggestions">
      <div class="suggestion" onclick="ask('What seafood do you have today?')">
        ü¶û What seafood do you have today?
      </div>
      <div class="suggestion" onclick="ask('How long is the wait?')">
        ‚è∞ How long is the wait?
      </div>
      <div class="suggestion" onclick="ask('What are your crawfish prices?')">
        üí∞ What are your crawfish prices?
      </div>
      <div class="suggestion" onclick="ask('Do you have oysters?')">
        ü¶™ Do you have oysters?
      </div>
    </div>
  </div>
</div>

<div class="input-area">
  <div class="input-wrapper">
    <input 
      type="text" 
      id="input" 
      placeholder="Ask me anything..."
      onkeypress="if(event.key==='Enter') send()"
    />
    <button class="send-btn" id="sendBtn" onclick="send()">Send</button>
  </div>
</div>

<script>
const API = 'https://script.google.com/macros/s/AKfycbzJoD0PyD3Y0tMSUl4g5UWHenFSlVDuMx_vDMAc9LjHKgObGhZ-D3HBPJeDkOZR34YLEA/exec';
const messagesEl = document.getElementById('messages');
const inputEl = document.getElementById('input');
const sendBtn = document.getElementById('sendBtn');
const welcomeEl = document.getElementById('welcome');

let isFirstMessage = true;

function addMessage(text, type) {
  if (isFirstMessage && welcomeEl) {
    welcomeEl.remove();
    isFirstMessage = false;
  }

  const msg = document.createElement('div');
  msg.className = 'message ' + type;
  
  msg.innerHTML = `
    <div class="avatar">${type === 'user' ? 'üë§' : 'ü¶û'}</div>
    <div class="bubble">${text}</div>
  `;
  
  messagesEl.appendChild(msg);
  messagesEl.scrollTop = messagesEl.scrollHeight;
}

function showThinking() {
  const thinking = document.createElement('div');
  thinking.className = 'thinking';
  thinking.id = 'thinking';
  
  thinking.innerHTML = `
    <div class="avatar">ü¶û</div>
    <div class="bubble">
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
    </div>
  `;
  
  messagesEl.appendChild(thinking);
  messagesEl.scrollTop = messagesEl.scrollHeight;
}

function hideThinking() {
  const thinking = document.getElementById('thinking');
  if (thinking) thinking.remove();
}

async function ask(question) {
  inputEl.value = question;
  send();
}

async function send() {
  const question = inputEl.value.trim();
  if (!question) return;

  addMessage(question, 'user');
  inputEl.value = '';
  sendBtn.disabled = true;

  showThinking();

  try {
    // Get current inventory data
    const invRes = await fetch(`${API}?action=getInventory`);
    const invData = await invRes.json();
    
    // Get current waitlist data
    const waitRes = await fetch(`${API}?action=getWaitlist`);
    const waitData = await waitRes.json();
    
    // Build context
    const inventory = invData.success ? invData.data : [];
    const waitlist = waitData.success ? waitData.data.filter(g => g.status === 'Waiting') : [];
    
    let answer = '';
    
    // Simple AI logic based on keywords
    const q = question.toLowerCase();
    
    if (q.includes('crawfish') || q.includes('price')) {
      const crawfish = inventory.find(i => i.item === 'Crawfish');
      if (crawfish && crawfish.status === 'AVAILABLE') {
        answer = `We have fresh crawfish today at $${Number(crawfish.price).toFixed(2)} per pound! ü¶û`;
      } else {
        answer = "Sorry, we're currently out of crawfish. Check back soon!";
      }
    }
    else if (q.includes('oyster')) {
      const char = inventory.find(i => i.item === 'Chargrilled Oysters');
      const raw = inventory.find(i => i.item === 'Raw Oysters');
      
      let msg = [];
      if (char && char.status === 'AVAILABLE') {
        msg.push(`Chargrilled Oysters: $${Number(char.price).toFixed(2)}`);
      }
      if (raw && raw.status === 'AVAILABLE') {
        msg.push(`Raw Oysters: $${Number(raw.price).toFixed(2)}`);
      }
      
      answer = msg.length > 0 
        ? `We have: ${msg.join(' and ')} ü¶™` 
        : "Sorry, we're out of oysters right now.";
    }
    else if (q.includes('wait') || q.includes('long')) {
      const count = waitlist.length;
      if (count === 0) {
        answer = "Great news! There's no wait right now. Come on in! üéâ";
      } else if (count <= 3) {
        answer = `We have ${count} ${count === 1 ? 'party' : 'parties'} ahead of you. About 15-20 minutes.`;
      } else {
        answer = `We have ${count} parties ahead of you. About 30-45 minutes. You can join the waitlist and we'll text you!`;
      }
    }
    else if (q.includes('menu') || q.includes('have') || q.includes('seafood')) {
      const available = inventory.filter(i => i.status === 'AVAILABLE');
      if (available.length > 0) {
        const items = available.map(i => `${i.item} ($${Number(i.price).toFixed(2)})`).join(', ');
        answer = `Today we have: ${items} ü¶ûü¶™ü¶Ä`;
      } else {
        answer = "Let me check our menu for you...";
      }
    }
    else if (q.includes('crab')) {
      const crab = inventory.find(i => i.item === 'Snow Crab');
      if (crab && crab.status === 'AVAILABLE') {
        answer = `Yes! Snow Crab is available at $${Number(crab.price).toFixed(2)} ü¶Ä`;
      } else {
        answer = "Sorry, we're out of crab right now.";
      }
    }
    else if (q.includes('shrimp')) {
      const shrimp = inventory.find(i => i.item === 'Peel & Eat Shrimp');
      if (shrimp && shrimp.status === 'AVAILABLE') {
        answer = `We have Peel & Eat Shrimp at $${Number(shrimp.price).toFixed(2)} ü¶ê`;
      } else {
        answer = "Sorry, we're out of shrimp right now.";
      }
    }
    else {
      answer = "I can help you with info about our seafood, prices, and wait times! What would you like to know?";
    }
    
    hideThinking();
    addMessage(answer, 'bot');
  } catch (err) {
    hideThinking();
    addMessage("Sorry, I'm having trouble connecting. Please try again!", 'bot');
    console.error(err);
  }

  sendBtn.disabled = false;
}
</script>

</body>
</html>
