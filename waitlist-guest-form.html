<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dodie’s Waitlist</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 0; padding: 24px; background:#0b0b0d; color:#fff; }
    .card { max-width: 520px; margin: 0 auto; background:#14141a; border:1px solid #2a2a35; border-radius:16px; padding:18px; }
    h1 { font-size: 20px; margin: 0 0 12px; }
    label { display:block; font-size: 13px; opacity:.9; margin: 12px 0 6px; }
    input, textarea, select { width:100%; box-sizing:border-box; padding:12px; border-radius:12px; border:1px solid #2a2a35; background:#0f0f14; color:#fff; }
    textarea { min-height: 90px; resize: vertical; }
    .row { display:flex; gap:12px; }
    .row > * { flex:1; }
    .checks { display:flex; flex-direction:column; gap:10px; margin-top: 12px; }
    .check { display:flex; gap:10px; align-items:flex-start; font-size: 13px; line-height:1.25; }
    .check input { width:18px; height:18px; margin-top:2px; }
    button { width:100%; margin-top:14px; padding:12px 14px; border-radius:12px; border:0; background:#21c55d; color:#04120a; font-weight:700; cursor:pointer; }
    button[disabled] { opacity:.6; cursor:not-allowed; }
    .msg { margin-top: 12px; font-size: 13px; white-space: pre-wrap; }
    .ok { color:#86efac; }
    .err { color:#fca5a5; }
    .tiny { font-size: 12px; opacity:.75; margin-top:10px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Join Dodie’s Waitlist</h1>

    <form id="waitlistForm">
      <label for="name">Name</label>
      <input id="name" name="name" autocomplete="name" required />

      <label for="phone">Phone</label>
      <input id="phone" name="phone" inputmode="tel" autocomplete="tel" placeholder="(214) 555-1234" required />

      <div class="row">
        <div>
          <label for="partySize">Party Size</label>
          <select id="partySize" name="partySize" required>
            <option value="">Select…</option>
            <option>1</option><option>2</option><option>3</option><option>4</option>
            <option>5</option><option>6</option><option>7</option><option>8</option>
            <option>9</option><option>10</option>
          </select>
        </div>
        <div>
          <label for="specialNotes">Special Notes (optional)</label>
          <input id="specialNotes" name="specialNotes" placeholder="High chair, patio, birthday…" />
        </div>
      </div>

      <div class="checks">
        <label class="check">
          <input type="checkbox" id="smsConsent" />
          <span>I agree to receive waitlist texts (updates about my table).</span>
        </label>

        <label class="check">
          <input type="checkbox" id="marketingOptIn" />
          <span>Text me specials & crawfish alerts (optional).</span>
        </label>
      </div>

      <button id="submitBtn" type="submit">Get on the Waitlist</button>
      <div id="msg" class="msg"></div>
      <div class="tiny">Standard messaging rates may apply. Reply STOP to unsubscribe.</div>
    </form>
  </div>

  <script>
    // ✅ Your Apps Script Web App URL
    const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbzJoD0PyD3Y0tMSUl4g5UWHenFSlVDuMx_vDMAc9LjHKgObGhZ-D3HBPJeDkOZR34YLEA/exec";

    const $ = (id) => document.getElementById(id);

    function normalizePhoneClient(phone) {
      // Keep + if present, otherwise strip non-digits and assume US if 10 digits
      const raw = String(phone || "").trim();
      const digits = raw.replace(/\D/g, "");
      if (digits.length === 10) return "+1" + digits;
      if (digits.length === 11 && digits.startsWith("1")) return "+" + digits;
      if (raw.startsWith("+")) return raw;
      // fallback
      return raw;
    }

    $("waitlistForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const btn = $("submitBtn");
      const msg = $("msg");
      msg.textContent = "";
      msg.className = "msg";

      const name = $("name").value.trim();
      const phone = normalizePhoneClient($("phone").value);
      const partySize = $("partySize").value.trim();
      const specialNotes = $("specialNotes").value.trim();

      const smsConsent = $("smsConsent").checked ? "Yes" : "No";
      const marketingOptIn = $("marketingOptIn").checked ? "Yes" : "No";

      if (!name || !phone || !partySize) {
        msg.textContent = "Please fill out Name, Phone, and Party Size.";
        msg.classList.add("err");
        return;
      }

      btn.disabled = true;
      btn.textContent = "Submitting…";

      // ✅ IMPORTANT: parameter names match Apps Script exactly
      const params = new URLSearchParams({
        action: "addtowaitlist",
        name,
        phone,
        partySize,
        specialNotes,
        smsConsent,
        marketingOptIn
      });

      try {
        const res = await fetch(`${WEBAPP_URL}?${params.toString()}`, { method: "GET" });
        const data = await res.json();

        if (data && data.success) {
          msg.textContent = "You’re on the waitlist! We’ll text you updates.";
          msg.classList.add("ok");
          $("waitlistForm").reset();
        } else {
          msg.textContent = "Could not add to waitlist:\n" + (data && data.error ? data.error : "Unknown error");
          msg.classList.add("err");
        }
      } catch (err) {
        msg.textContent = "Network error. Please try again.\n" + err.message;
        msg.classList.add("err");
      } finally {
        btn.disabled = false;
        btn.textContent = "Get on the Waitlist";
      }
    });
  </script>
</body>
</html>
